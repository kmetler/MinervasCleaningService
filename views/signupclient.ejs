<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Client</title>
</head>
<body>
    <main>
        <h1 style="text-align: center; font-size: 40px;">Add New Client</h1>
        <form action="/signupclient" method="POST">
            <section>
                <h2>Client Information</h2>
                <div>
                    <label for="clientfirst">First Name:</label>
                    <input type="text" id="clientfirst" name="clientfirst" placeholder="Enter first name" required>
                </div>
                <div>
                    <label for="clientlast">Last Name:</label>
                    <input type="text" id="clientlast" name="clientlast" placeholder="Enter last name" required>
                </div>
                <div>
                    <label for="clientstreetaddress">Street Address:</label>
                    <input type="text" id="clientstreetaddress" name="clientstreetaddress" placeholder="Enter street address" required>
                </div>
                <div>
                    <label for="clientcity">City:</label>
                    <input type="text" id="clientcity" name="clientcity" placeholder="Enter city" required>
                </div>
                <div>
                    <label for="clientstate">State:</label>
                    <input maxlength="2" type="text" id="clientstate" name="clientstate" placeholder="Enter state (VA)" required>
                </div>
                <div>
                    <label for="clientzipcode">Zip Code:</label>
                    <input type="number" id="clientzipcode" name="clientzipcode" placeholder="Enter zip code" required>
                </div>
                <div>
                    <label for="clientphone">Phone:</label>
                    <input type="tel" id="clientphone" name="clientphone" placeholder="Enter phone (123-456-7890)" pattern="^\d{3}-\d{3}-\d{4}$" required>
                </div>
                <div>
                    <label for="clientemail">Email:</label>
                    <input type="email" id="clientemail" name="clientemail" placeholder="Enter email address" required>
                </div>
            </section>

            <section>
                <h2>Service Information</h2>
                <!-- Building Type Dropdown -->
                <div>
                    <label for="buildingtype">Building Type:</label>
                    <select id="buildingtype" name="buildingtype" required>
                        <option value="" disabled selected>Select a building type</option>
                        <% buildingTypes.forEach(building => { %>
                            <option value="<%= building.buildingid %>"><%= building.buildingtype %></option>
                        <% }); %>
                    </select>
                </div>
    
                <!-- Service Type Dropdown -->
                <div>
                    <label for="servicetype">Service Type:</label>
                    <select id="servicetype" name="servicetype" required>
                        <option value="" disabled selected>Select a service type</option>
                        <% serviceTypes.forEach(service => { %>
                            <option value="<%= service.serviceid %>"><%= service.typename %></option>
                        <% }); %>
                    </select>
                </div>
    
                <!-- Display Price -->
                <div>
                    <p id="price-display" style="font-weight: bold; font-size: 18px;">Price: $<span id="price">0.00</span> per month</p>
                </div>
            </section>

            <button type="submit">Add Client</button>
            <button type="button" onclick="window.location.href='/';">Cancel</button>
        </form>

        <!-- JavaScript for dynamic price updates -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const buildingType = document.getElementById('buildingtype');
                const serviceType = document.getElementById('servicetype');
                const priceDisplay = document.getElementById('price');

                async function updatePrice() {
                    const buildingId = buildingType.value;
                    const serviceId = serviceType.value;

                    if (buildingId && serviceId) {
                        try {
                            const response = await fetch(`/getprice?buildingid=${buildingId}&serviceid=${serviceId}`);
                            const data = await response.json();
                            if (data.success) {
                                priceDisplay.textContent = data.price.toFixed(2);
                            } else {
                                priceDisplay.textContent = "0.00";
                            }
                        } catch (error) {
                            console.error('Error fetching price:', error);
                            priceDisplay.textContent = "0.00";
                        }
                    } else {
                        priceDisplay.textContent = "0.00";
                    }
                }

                buildingType.addEventListener('change', updatePrice);
                serviceType.addEventListener('change', updatePrice);
            });
        </script>

    </main>
</body>
</html>